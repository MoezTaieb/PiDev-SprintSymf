
{% extends 'base.html.twig' %}

{% block body %}
    {% include 'smalBanner.html.twig' %}

    <div class="listing-section content-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-12">
                    <div class="sidebar-right">
                        <!-- Advanced search start -->
                        <div class="widget-4 advanced-search">
                            <form method="GET" class="informeson">
                                <div class="form-group">

                                    <label ><a href="{{ path('search') }}">Keywords</a></label>
                                    <input  type="text" id="search" class="form-control selectpicker search-fields" placeholder="Search Keywords">
                                </div>

                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8 col-md-12">
                    <!-- Option bar start -->
                    <div class="option-bar d-none d-xl-block d-lg-block d-md-block d-sm-block">
                        <div class="row">
                            <div class="col-lg-6 col-md-7 col-sm-7">
                                <div class="sorting-options2">
                                    <ul class="nav nav-tabs">
                                        <li class="nav-item dropdown">
                                            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Sort by:</a>
                                            <div class="dropdown-menu">
                                                <a  id="sortbydate" class="dropdown-item"> <span class="sort">publishing date</span></a>
                                                <a id="sortbytitle"  class="dropdown-item">  <span class="sort">title</span></a>
                                            </div>
                                        </li>
                                    </ul>

                                </div>


                            </div>

                        </div>
                    </div>
                    <!-- Emplayer box start -->
                    <div class="employer-list">
                    {% for annonce in annonces %}
                    <div class="employer-box">
                        <div class="employer-photo">
                            <a href="#">

                                {%  if 	annonce.posteur.imageUrlUser==null %}
                                    <img src="{{ asset('front/img/user.png') }}" >

                                {% else %}
                                    <img src="{{ annonce.posteur.imageUrlUser }}" >

                                {% endif %}
                                <h6>{{annonce.posteur.username }}</h6>
                            </a>
                        </div>
                        <div class="employer-info">
                            <h5><a href="{{ path('showDetails', {id: annonce.id}) }}" >{{annonce.titreAnnonce}} </a></h5>
                            <div class="employer-meta">
                            </div>
                            {{annonce.descriptionAnnonce[:140]}}...
                            <p></p>
                        </div>
                    </div>

                    {% endfor %}

                    <div id="pagi">
                        <!-- Page navigation start-->
                        {{ knp_pagination_render(annonces) }}
                    </div>

                </div>

                    <div id="entitiesNav"></div>

                </div>

            </div>
        </div>
    </div>





    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            var searchRequest = null;
            $("#search").mouseenter(function(){
             $(".employer-list").hide();
             //   var entitySelector = $("#search").hide();


            });
            $("#search").mouseleave(function(){
                var value = $(this).val();
                if (value.length <1 )
                {
                      $(".employer-list").show();
                }

            });

            $("#sortbydate").click(function(){
                $(".employer-list").hide();

                var searchRequest = null;
                    var minlength = 1;
                    var that = this;
                    var entitySelector = $("#entitiesNav").html('');

                        if (searchRequest != null)
                            searchRequest.abort();
                        searchRequest = $.ajax({
                            type: "GET",
                            url: "{{ path('orderByDateDESC') }}",
                            dataType: "text",
                            success: function(msg){
                                //we need to check if the value is the same

                                    var result = JSON.parse(msg);
                                    console.log(result);
                                    $.each(result, function(key, arr) {
                                        $.each(arr, function(id, value) {

                                            if (id !== 'error') {

                                                // entitySelector.append('<li><br>+value["titre"]+'<a></a></li>');


                                                if(value["imageUrlUser"]!==null)
                                                    var src=value["imageUrlUser"];
                                                else
                                                    var src="front/img/user.png";



                                                /*   if(annonce.posteur.imageUrlUser==null)
                                                       front/img/user.png

                                                   else
                                                       annonce.posteur.imageUrlUser


                                                   annonce.posteur.username

                                                   path('showDetails', {id: annonce.id})*/

                                                var path=' href="/showDetails/'+value["id"]+'" ';
                                                var descriptionAnnonce=value["desc"].substr(0, 140);
                                                entitySelector.append('  <div class="employer-box">  <div class="employer-photo"><a> <img src="'+src+'"> </a></div><div class="employer-info"><h5><a'+path+'>'+value["titre"]+'</a></h5><div class="employer-meta"> <h6> '+value["username"]+' </h6></div>'+descriptionAnnonce+'<p></p></div></div>');
                                                // entitySelector.append('<li><br>'+value["titre"]+'<a></a></li>');





                                            } else {
                                                entitySelector.append('<li class="errorLi">'+value+'</li> ');
                                            }

                                        });
                                    });

                            }

                        });



                        /*
                    if (value.length <1 )
                    {
                        var entitySelector =  $(".employer-list").show();
                    }


*/



                ///
            });


            $("#sortbytitle").click(function(){
                 $(".employer-list").hide();

                var searchRequest = null;
                var minlength = 1;
                var that = this;
                var entitySelector = $("#entitiesNav").html('');

                if (searchRequest != null)
                    searchRequest.abort();
                searchRequest = $.ajax({
                    type: "GET",
                    url: "{{ path('orderByDateTitle') }}",
                    dataType: "text",
                    success: function(msg){
                        //we need to check if the value is the same

                        var result = JSON.parse(msg);
                        console.log(result);
                        $.each(result, function(key, arr) {
                            $.each(arr, function(id, value) {

                                if (id !== 'error') {

                                    // entitySelector.append('<li><br>+value["titre"]+'<a></a></li>');


                                    if(value["imageUrlUser"]!==null)
                                        var src=value["imageUrlUser"];
                                    else
                                        var src="front/img/user.png";



                                    /*   if(annonce.posteur.imageUrlUser==null)
                                           front/img/user.png

                                       else
                                           annonce.posteur.imageUrlUser


                                       annonce.posteur.username

                                       path('showDetails', {id: annonce.id})*/

                                    var path=' href="/showDetails/'+value["id"]+'" ';
                                    var descriptionAnnonce=value["desc"].substr(0, 140);
                                    entitySelector.append('  <div class="employer-box">  <div class="employer-photo"><a> <img src="'+src+'"> </a></div><div class="employer-info"><h5><a'+path+'>'+value["titre"]+'</a></h5><div class="employer-meta"> <h6> '+value["username"]+' </h6></div>'+descriptionAnnonce+'<p></p></div></div>');
                                    // entitySelector.append('<li><br>'+value["titre"]+'<a></a></li>');





                                } else {
                                    entitySelector.append('<li class="errorLi">'+value+'</li> ');
                                }

                            });
                        });

                    }

                });

            });

            $("#search").keyup(function() {
                var minlength = 1;
                var that = this;
                var value = $(this).val();
                var entitySelector = $("#entitiesNav").html('');

                if (value.length >= minlength ) {
                    if (searchRequest != null)
                        searchRequest.abort();
                    searchRequest = $.ajax({
                        type: "GET",
                        url: "{{ path('ajax_search') }}",
                        data: {
                            'q' : value
                        },
                        dataType: "text",
                        success: function(msg){
                            //we need to check if the value is the same
                            if (value===$(that).val()) {
                                var result = JSON.parse(msg);
                                console.log(result);
                                $.each(result, function(key, arr) {
                                    $.each(arr, function(id, value) {

                                        if (id !== 'error') {

                                            // entitySelector.append('<li><br>+value["titre"]+'<a></a></li>');


                                            if(value["imageUrlUser"]!==null)
                                                var src=value["imageUrlUser"];
                                            else
                                                var src="front/img/user.png";



                                            /*   if(annonce.posteur.imageUrlUser==null)
                                                   front/img/user.png

                                               else
                                                   annonce.posteur.imageUrlUser


                                               annonce.posteur.username

                                               path('showDetails', {id: annonce.id})*/

                                            var path=' href="/showDetails/'+value["id"]+'" ';
                                            var descriptionAnnonce=value["desc"].substr(0, 140);
                                            entitySelector.append('  <div class="employer-box">  <div class="employer-photo"><a> <img src="'+src+'"> </a></div><div class="employer-info"><h5><a'+path+'>'+value["titre"]+'</a></h5><div class="employer-meta"> <h6> '+value["username"]+' </h6></div>'+descriptionAnnonce+'<p></p></div></div>');
                                            // entitySelector.append('<li><br>'+value["titre"]+'<a></a></li>');





                                        } else {
                                            entitySelector.append('<li class="errorLi">'+value+'</li> ');
                                        }

                                    });
                                });
                            }
                        }

                    });
                }

                if (value.length <1 )
                {
                    var entitySelector =  $(".employer-list").show();
                }



            });
        });
    </script>


{% endblock%}



